@using SimpleFeed.HtmlHelpers
@model SimpleFeed.Data.OperationResults.ModelWithCreator<SimpleFeed.Core.FeedEntries.Base.FeedEntryBase>

<div class="feed-entry">
    <div class="feed-entry-createdby">
        <div class="feed-entry-author">
            <img src="/images/user_default.png" /> @Model.Creator.UserName
        </div>
        <time class="timeago" datetime="@Model.Model.CreationDate.ToString("s", System.Globalization.CultureInfo.InvariantCulture)">
            @Model.Model.CreationDate.ToString("d")
        </time>
    </div>

    @Html.FeedEntryPartialFor(Model.Model)

    <div class="feed-entry-title">
        <div class="feed-entry-votes-wrapper">
            @using (Html.BeginForm("MakeVoteForFeedEntry", "Vote", new { votedEntryId = @Model.Model.Id, isUpvote = true },
                FormMethod.Post, true, new { id = $"upvote-{ Model.Model.Id }" }))
            {
                <div class="vote-img-wrapper">
                    <button type="submit">
                        <img src="/images/icons/ico-upvote.png">
                    </button>
                </div>
            }
            <div id="votescount-@Model.Model.Id" class="feed-entry-votescount">
                <span>@Model.Model.VotesBalance</span>
            </div>
            @using (Html.BeginForm("MakeVoteForFeedEntry", "Vote", new { votedEntryId = @Model.Model.Id, isUpvote = false },
                FormMethod.Post, true, new { id = $"downvote-{Model.Model.Id}" }))
            {
                <div class="vote-img-wrapper">
                    <button type="submit">
                        <img src="/images/icons/ico-downvote.png">
                    </button>
                </div>
            }
        </div>
        <a href="@Url.Action("GetEntry", new {entryId = Model.Model.Id})">@Model.Model.Title</a>
    </div>
    <div class="feed-entry-desc">
        @Model.Model.Description
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded",
        function() {
            wireSubmitVote("@Model.Model.Id.ToString()", true);
            wireSubmitVote("@Model.Model.Id.ToString()", false);
            $("time.timeago").timeago();
        });
</script>
